pipeline {
    agent any
    environment {
        GOOGLE_CREDENTIALS = credentials('jenkins-service-gcp')
    }
    stages {
        stage('Setting Up') {
            steps {
                sh '''
                gcloud version
                gcloud auth activate-service-account --key-file=$GOOGLE_CREDENTIALS
                terraform apply -auto-approve 
                '''
            }
        }
    stage('Deploy Infrastructure'){
        steps {
            sh '''
            terraform init
            terraform apply
            '''
            }
        }
    }
}